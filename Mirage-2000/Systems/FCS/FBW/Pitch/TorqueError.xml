<?xml version="1.0" encoding="iso-8859-1"?>
<!-- 
	Authors: Axel Paccalin.
	Version: 0.1
	
	TODO ...
-->

<system name="Mirage-2000: FCS/FBW">
	<property value=  "5"> fcs/fbw/pitch/torque/accel-Kp </property>    <!-- Tuning param (gain to convert alpha-rate error to angular-acceleration error) -->

	<channel name="Pitch">	
		<!-- Compute angular acceleration error around the Y axis according to the error in the alpha-rate demand -->
		<fcs_function name="fcs/fbw/pitch/torque/accel-error">
			<function>
				<product>
					<p> fcs/fbw/pitch/q-rate/error </p>
					
					<p> fcs/fbw/pitch/torque/accel-Kp </p> 
				</product>
			</function>
		</fcs_function>
		
		<!-- Compute the torque required along each axis to meet the demanded angular acceleration on the Y axis for a non rotating body. [tau = omega * J] -->
		<!-- Torque required along the roll axis -->
		<fcs_function name="fcs/fbw/roll/torque/demand/static/m">
			<function>
				<product>
					<p> fcs/fbw/pitch/torque/accel-error </p>
					<p> inertia/j/xy </p>
				</product>
			</function>
		</fcs_function>
		<!-- Torque required along the pitch axis -->
		<fcs_function name="fcs/fbw/pitch/torque/demand/static/m">
			<function>
				<product>
					<p> fcs/fbw/pitch/torque/accel-error </p>
					<p> inertia/j/yy </p>
				</product>
			</function>
		</fcs_function>
		<!-- Torque required along the yaw axis -->
		<fcs_function name="fcs/fbw/yaw/torque/demand/static/m">
			<function>
				<product>
					<p> fcs/fbw/pitch/torque/accel-error </p>
					<p> inertia/j/zy </p>
				</product>
			</function>
		</fcs_function>
		
		<!-- Sum the torque demand related to the pitch axis, computed via the error in each axes angular-acceleration -->
		<summer name="fcs/fbw/pitch/torque/demand/static/total">
			<input> fcs/fbw/pitch/torque/demand/static/l </input>
			<input> fcs/fbw/pitch/torque/demand/static/m </input>
			<input> fcs/fbw/pitch/torque/demand/static/n </input>
		</summer>
		
		<!-- Actual aerodynamic torque required -->
		<summer name="fcs/fbw/pitch/torque/demand/dynamic">
			<input> fcs/fbw/pitch/torque/demand/static/total </input>
			<input> torque/momentum/y </input>
		</summer>
		
		<!-- Error in torque [error = demand - current] -->
		<fcs_function name="fcs/fbw/pitch/torque/error">
			<function>
				<difference>
					<p> fcs/fbw/pitch/torque/demand/dynamic </p>

					<product>
						<sum>
							<p> moments/m-aero-lbsft </p>
							<p> moments/m-prop-lbsft </p>
						</sum>
						<p> units/lbsft-nm </p>
					</product>
				</difference>
			</function>
		</fcs_function>
		<summer name="fcs/fbw/pitch/torque/error">
			<input> fcs/fbw/pitch/torque/demand/dynamic </input>
			<input> -torque/aero/y </input>
		</summer>
		
		<!-- The aerodynamic factor applied to the pitch torque coefficient -->
		<fcs_function name="fcs/fbw/pitch/torque/aero-factor">
			<function>
				<product>
					<p> aero/qsw </p>
					<p> metrics/cbarw-ft </p>
				</product>
			</function>
		</fcs_function>	
		
		<!-- Compute the error in the torque coefficient -->
		<fcs_function name="fcs/fbw/pitch/torque/k-error">
			<function>
				<quotient>
					<p> fcs/fbw/pitch/torque/error </p>
					
					<!-- Make sure we never divide by 0 (should only happen when the plane is stopped, relative to the wind). -->
					<ifthen>
						<ge>
							<p> fcs/fbw/pitch/torque/aero-factor </p>
							<value> 0.00000001 </value>
						</ge>

						<p> fcs/fbw/pitch/torque/aero-factor </p>

						<value> 0.00000001 </value>
					</ifthen>
				</quotient>
			</function>
		</fcs_function>
	</channel>
</system>